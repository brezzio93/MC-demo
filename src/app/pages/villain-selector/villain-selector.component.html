
<!-- Set Villain -->
<h5 class="normalText">Select Encounter</h5>
<dx-select-box *ngIf="!settingsReady"
    [items]="villains" 
    displayExpr="text" 
    valueExpr="id" 
    (onValueChanged)="selectVillain($event.value)">
</dx-select-box> 

<ng-container *ngIf="villain != undefined">
    <!-- Villain Phase -->
    <dx-tabs 
        [dataSource]="villain.villain_phases"
        keyExpr="octgn_id"
        displayExpr="stage"
        [selectedItem]="villain.villain_phases[0]"
        (onItemClick)="selectPhase($event.itemData)">
    </dx-tabs>
    <ng-container *ngIf="villainPhase != undefined">
        <div class="row" style="margin-top: 2rem;">
            <!-- Villain HP -->
            <div class="col">
                <h4 class="normalText">{{villain.text}}</h4>
                <h5 class="normalText">{{villainPhase.currentHP}} / {{villainPhase.maxHP}} HP</h5>
                <div *ngIf="settingsReady">
                    <dx-button style="margin-top: 1rem;" (onClick)="updateHP(1)" icon="minus"> </dx-button>
                    <dx-button style="margin-top: 1rem;" (onClick)="updateHP(-1)" icon="plus"> </dx-button>                    
                </div>
                <table>
                    <tr *ngFor="let row of lifePointsUI;">
                        <td *ngFor="let circle of row">
                            <div class="hpBorder">
                                <div [ngClass]="{
                                    hpCenter:circle.state == true,
                                    hpOverflow: (villainPhase.currentHP > villainPhase.maxHP) && circle.index > villainPhase.maxHP
                                }"></div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <!-- Main Scheme -->
            <div class="col">
                <h4 class="normalText">{{villain.main_scheme[schemePhase].real_name}} </h4>
                <h5 *ngIf="accelToken == 0"class="normalText">{{currentScheme}} / {{villain.main_scheme[schemePhase].maxEnd}}</h5>
                <h5 *ngIf="accelToken != 0"class="normalText">{{currentScheme}} / {{villain.main_scheme[schemePhase].maxEnd}} (Accelerations Tokens: {{accelToken}}) </h5>
                <div *ngIf="settingsReady">
                    <dx-button style="margin-top: 1rem;" (onClick)="advancePhaseOne()" text="Phase 1"> </dx-button>
                    <dx-button style="margin-top: 1rem;" (onClick)="updateMainScheme(1)" icon="minus"> </dx-button>
                    <dx-button style="margin-top: 1rem;" (onClick)="updateMainScheme(-1)" icon="plus"> </dx-button>
                    <dx-button style="margin-top: 1rem;" (onClick)="acceleratePlan()" text="Accelerate"> </dx-button>
                    <dx-button style="margin-top: 1rem;" 
                    *ngIf="
                    (currentScheme >= villain.main_scheme[schemePhase].maxEnd)" 
                        (onClick)="setMainSchemeUI(schemePhase + 1)" icon="greater"> 
                    </dx-button>
                </div>
                <table>
                    <tr *ngFor="let row of mainSchemeUI">
                        <td *ngFor="let circle of row; index as i">
                            <div class="hpBorder">
                                <div [ngClass]="{
                                    schemeCenter:circle.state == true, 
                                    schemeToAdvance:circle.state == false && villain.main_scheme[schemePhase].toAdvance >= circle.index
                                }"></div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <hr>
        
        <div class="row" style="margin-top: 2rem;">
            <div class="col">
                <!-- Side Schemes -->
                <ng-container *ngFor="let plan of plansInPlay">
                    <div class="schemeDiv">
                        <h4 class="normalText"> {{plan.text}} </h4>
                        <h5 class="normalText">{{plan.current}} / {{plan.end}} </h5>
                        <div>
                            <dx-button style="margin-top: 1rem;" *ngIf="settingsReady" (onClick)="updateSideScheme(1, plan)" icon="minus"> </dx-button>
                            <dx-button style="margin-top: 1rem;" *ngIf="settingsReady" (onClick)="updateSideScheme(-1, plan)" icon="plus"> </dx-button>
                            <dx-button style="margin-top: 1rem;" *ngIf="plan.current == 0 || !settingsReady"  (onClick)="removePlan(plan.id)" icon="remove"> </dx-button>
                        </div>
                        <table>
                            <tr *ngFor="let row of plan.planUI;">
                                <td *ngFor="let circle of row">
                                    <div class="hpBorder">
                                        <div [ngClass]="{
                                            schemeCenter:circle.state == true,
                                            schemeOverflow: (plan.current > plan.end) && circle.index > plan.end
                                        }"></div>
                                    </div>
                                </td>
                            </tr>
                        </table>                    
                    </div>
                </ng-container>
            </div>
            <div class="col-3">
                <!-- Set Modular Sets -->
                <div *ngIf="!settingsReady">
                    <h2 class="normalText">Select Modular Sets</h2>
                    <dx-list
                        [dataSource]="modularSets"
                        [selectionMode]="modularSetsSelection"
                        [showSelectionControls]="true"
                        [selectByClick]="true"
                        (onSelectionChanged)="selectScheme($event)"
                    ></dx-list>
                </div>
                <!-- Put scheme on play -->
                <h2 class="normalText">Put scheme on Play</h2>
                <dx-select-box
                    [items]="planList" 
                    displayExpr="text" 
                    valueExpr="id" 
                    (onValueChanged)="putPlanInPlay($event.value)">
                </dx-select-box>

                <!-- Start Game -->
                <dx-button *ngIf="!settingsReady"
                    style="margin-top: 1rem;"
                    (onClick)="startGame()"
                    text="Ready?">
                </dx-button>
            </div>
        </div>
    </ng-container>
</ng-container>